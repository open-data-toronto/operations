# Operations resource for Open Data Team

Home for all operations related code and solutions for the day-to-day management of the Open Data Toronto Catalogue.

## Overview

### Folders

At a high level, the project contains the following directories:

1. *scripts*: home for all scripts running operationally, eg. frequent, basis; also includes some utility functions to facilitate ad-hoc work. These are all written in Python 3.7
1. *environment*: files needed to set up a virtual environment to execute the scripts above, including Python runtime environment as well as library dependencies
1. *configs*:  files with configuration values used by the scripts, such as environment to run against or list of files to sync

The following directories are not checked in because they are temporary but needed by at least one of the scripts:

1. *backups*: Created automatically if not found. It is for storing backups of datastore resource data and dictionaries in `parquet` and `json` formats, respectively.
1. *logs*: Created automatically if not found. It is for logs generated by the scripts, files are named using the pattern: `<script_name>-<log_level>.log`. Each time a script runs, new logs are appended to the bottom of its respective log file.
1. *staging*: Must be created manually. Scripts having to load a local data file(s) locally will search for them here.

#### Recommendation: tasks directory

When running scripts operationally via scheduled tasks, such as cronjobs or the Windows Task Manager, it is recommended to create a *tasks* folder with the the file to be executed by the task, `sh` or `bat` formats respectively, named the same as its corresponding Python script.

### Files

In addition to the standard MIT file and this README, the following files are also hosted in the root directory:

1. `.gitignore`: to control the files that can be checked into the repo. Started from a common template for Python projects, plus the following blobs:
   * `.bat`: Windows execution files similar to _shell_ for creating schedulable Windows tasks. May decide to include them in the future.
   * `.csv`, `.json`, `.xml`: common data file formats that could be checked into the repository by mistake, but are not used by the codebase - configuration files are written in `yaml`.
   * `.ipynb`: Jupyter Notebook file format, excluded because (For the purposes of this repo) these files are more for prototyping and cannot be operationalized easily (hence why we opt for the Python files instead). They can also be difficult to deal in version control due to saving state execution along with the code.
   * *tmp* directories: common naming convention for ephemeral directories containing files that should not be checked into the repo
   * `config.yaml`: configuration file used by the scripts that contain sensitive information, such as login information, that should not be checked into the repo
   * `.vscode/`: Visual Studio Code configuration files
   * `.DS_Store`: MacOS Finder file in every directory
   * *backups*, *staging*, *logs*: temporary directories mentioned above
1. `.pre-commit-config.yaml`: configuration file for managing git pre-commit hooks; essentially, before code can be committed to the repository checks in this file are performed - more details on this below.

## configs

`config.yaml.template`: used by the scripts for configuration values, such as login information. Copy and paste into the same directory, renaming it to `config.yaml`, as expected by the scripts.

`remote_files.yaml`: list of files in the GCC server that CKAN resources link to

## environment

`conda.yaml`
https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html

`requirements.txt`


`requirements_dev.txt`

```
https://blog.usejournal.com/why-and-how-to-make-a-requirements-txt-f329c685181e
```

## scripts

### get_empty_datastore_resources.py

### refresh_covid_data.py

### sync_remote_file_times.py

### transform_agol_to_datastore.py

### update_data_quality_scores.py

https://medium.com/open-data-toronto/towards-a-data-quality-score-in-open-data-part-1-525e59f729e9

https://medium.com/open-data-toronto/towards-a-data-quality-score-in-open-data-part-2-3f193eb9e21d

## Additional information

## Coding standards and consistency: pre-commit, black & flake8
https://pre-commit.com/
https://github.com/psf/black
https://flake8.pycqa.org/en/latest/